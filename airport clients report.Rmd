---
title: 'Удобство аэропортов и самолетов: оценки посетителей'
author: "Павленко Мария, mapavlenko_3"
output: 
  html_document:
    code_folding: show
---

## Задача

на основе данных (и выданных вопросов) постараться выяснить:

* какие проблемы есть в авиаперевозках
* какие улучшения можно предложить на основе выводов по данным

#### Загрузка данных и преобразование

```{r message=FALSE, warning=FALSE}
library(dplyr)
library(ggplot2)
library(lubridate)
source("~/shared/minor2_2023/1-Intro/hw1/hw1_data2.R")

airline = hw1_get_data(df_name = "airline")
airport = hw1_get_data(df_name = "airport")
lounge = hw1_get_data(df_name = "lounge")
seat = hw1_get_data(df_name = "seat")
hw1_get_questions()
```



```{r}
airline = airline %>%
  mutate(date = as.Date(date)) %>%
  mutate(author_country = as.factor(author_country)) %>%
  mutate(aircraft = as.factor(aircraft)) %>%
  mutate(airline_name = as.factor(airline_name)) %>%
  mutate(cabin_flown = as.factor(cabin_flown)) %>%
  mutate(title = as.factor(title)) %>%
  mutate(type_traveller = as.factor(type_traveller))

```

```{r}
airport = airport %>%
  mutate(airport_name = as.factor(airport_name)) %>%
  mutate(title = as.factor(title)) %>%
  mutate(author_country = as.factor(author_country)) %>%
  mutate(date = as.Date(date)) %>%
  mutate(date_visit = as.Date(date_visit)) %>%
  mutate(experience_airport = as.factor(experience_airport)) %>%
  mutate(type_traveller = as.factor(type_traveller))

```

```{r}
lounge = lounge %>%
  mutate(airline_name = as.factor(airline_name)) %>%
  mutate(airport = as.factor(airport)) %>%
  mutate(title = as.factor(title)) %>%
  mutate(author_country = as.factor(author_country)) %>%
  mutate(date = as.Date(date)) %>%
  mutate(date_visit = as.Date(date_visit)) %>%
  mutate(lounge_name = as.factor(lounge_name)) %>%
  mutate(lounge_type = as.factor(lounge_type)) %>%
  mutate(type_traveller = as.factor(type_traveller))

```

```{r}
seat = seat %>%
  mutate(airline_name = as.factor(airline_name)) %>%
  mutate(title = as.factor(title)) %>%
  mutate(author_country = as.factor(author_country)) %>%
  mutate(date = as.Date(date)) %>%
  mutate(date_flown = as.Date(date_flown)) %>%
  mutate(aircraft = as.factor(aircraft)) %>%
  mutate(seat_layout = as.factor(seat_layout)) %>%
  mutate(cabin_flown = as.factor(cabin_flown))

```


### Вопросы

#### Вопрос 1

**Вопрос:** Люди из каких стран ниже всего оценивают wi-fi в аэропортах?

**Данные:** для ответа на вопрос нужны таблицы: airport.

```{r}
wifi = airport %>%
  filter(!is.na(wifi_connectivity_rating)) %>%
  filter(!is.na(author_country)) %>%
  group_by(author_country) %>%
  summarise(mean_wifi_connectivity_rating = mean(wifi_connectivity_rating)) %>%
  arrange(mean_wifi_connectivity_rating) %>%
  filter(mean_wifi_connectivity_rating <= 3)

 
  ggplot() +
  geom_bar(data = wifi, aes(x = reorder(author_country, +mean_wifi_connectivity_rating), y = mean_wifi_connectivity_rating), stat = "identity", fill = "darkturquoise" , width = 0.4) + 
    theme(axis.text.x = element_text(angle = 45, hjust = 1))  + 
    xlab("Страны авторов, поставивших самые низкие оценки") + 
    ylab("Средняя оценка wi-fi") +
    ggtitle("Оценки wi-fi соединения в соответствии со странами авторов")
```

**Ответ:**  Для корректного восприятия ответа на поставленный вопрос необходимо учитывать, что в колонках оценки wi-fi в датасете airport отсутсвует 981 наблюдение, что влияет на результирующие данные. Отфилтровав недостающие данные в датасете, а также посчитав среднее значение оценки рейтинга для каждой упомянутой страны, было выявлено, что 5 странами авторы из которых оценивают wi-fi в аэропортах ниже всего стали: Объединенные Арабские Эмираты, Бельгия, Новая Зеландия, Швейцария и Великобритания. Данный рейтинг был составлен, опираясь на следующую операционализацию: средняя оценка wi-fi от 0 до 3 считается низкой, больше 3 и до 6 - средней, больше 6 и до 10 - высокой. 

**Вывод:** 3 из 5, авторы из которых оценивают интернет в аэропортах ниже всего, входят в топ-20 стран по медианной скорости интернета в мире, основываясь на рейтинге "Internet Speed by Country" от Wisevoter (https://wisevoter.com/country-rankings/internet-speed-by-country). А именно этими странами являются: Объединенные Арабские Эмираты, Новая Зеландия и Швейцария. При этом справедливо заметить, что оставшиеся 2 страны достаточно удалены от топ-20 (Бельгия на 42 и Великобритания на 55), из-за чего не получается с достаточной уверенностью заявить, что причина, по которой авторы оценивают wi-fi в аэропортах ниже обычного - высокая скорость интернета в их стране. С другой стороны, такая рискованная гипотеза все еще допустимоа, если учитывать количество отсутствующих данных, выбросы и погрешности, которые заключается в разном количестве оценок от авторов из разных стран, где от некоторых присутствует только одна, а от других несколько десятков. 

Всего 41,7% авторов оценивают wifi ниже среднего, остальные авторы ставят средние оценки, высокие являются исключением, что действительно может указывать на ненадлежащее качество wi-fi соединения в аэропортах.

Достаточно сложно сделать содержательные выводы и рекомендации из недостаточно большого количества данных, поэтому стоит отметит необходимость проведения дополнительных исследований, ориентированных на оценку посетителями  wi-fi соединения, которые бы учитывали страну проживания автора и местонахождение аэропорта и лаунджа, wi-fi которого они оценивают. 

#### Вопрос 2

**Вопрос:** В каких самолетах более высокие оценки удобства пространства для ног - те в которых два прохода или один?

**Данные:** для ответа на вопрос нужны таблицы: seat.

```{r}
library(stringr)
seat = seat %>%
  mutate(seat_layout = str_replace_all(seat_layout, "3-3", "3x3")) %>%
  mutate(seat_layout = str_replace_all(seat_layout, "3X3", "3x3")) %>%
  mutate(seat_layout = str_replace_all(seat_layout, "Deck", "2x3x2")) %>%
  filter(!is.na(seat_layout)) %>%
  filter(!is.na(seat_legroom_rating)) 


single = seat %>%
  filter(seat_layout == "3x3" | seat_layout == "3x2" | seat_layout == "2x2" | seat_layout == "2x3") %>%
  summarise(seat_legroom_rating = round(mean(seat_legroom_rating), 2))

double = seat %>%
  filter(seat_layout == "2x4x2" | seat_layout == "3x3x3" | seat_layout == "3x4x3" | seat_layout == "2x3x2" | seat_layout == "2x5x2" | seat_layout == "2x2x2") %>%
  summarise(seat_legroom_rating = round(mean(seat_legroom_rating), 1))


graph = rbind(single, double)
graph$type = c("Один проход", "Два прохода")

ggplot(graph, aes(x = type, y = seat_legroom_rating, fill = type, width = 0.35)) +
  geom_bar(stat = "identity", width = 0.5) +
  labs(x = "", y = "Средняя оценка удобства\nпространства для ног") +
  ggtitle("Средняя оценка пространства для ног в самолетах\nв зависимости от количества проходов") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.3)) + 
  scale_fill_discrete(name = "Тип") + 
  theme(legend.position = "none") + 
  geom_hline(yintercept = 2.8, color = "red")

```

**Ответ:** Для ответа на данный вопрос необходимо было определить какие самолеты имеют один проход, а какие два, в процессе чего в колонке, отвечающей за расположение сидений,  датасета airport было замечено наблюдение "Deck", а не стандартная цифровая последовательность. Его проблематичность заключается в том, что оно не говорит напрямую каким по количеству проходов являлся самолет, в котором летел автор комментария. Но с помощью использования информации о его модели "B747-400" и классе, в котором летел автор, было выяснено, что самолеты модели B747-400 в эконом классе имеют одну из вариаций расположения сидений, предполагающих два прохода, из-за чего это наблюдение было добавлено к другим самолетам с двумя проходами.

С помощью дальнейших преобразований было выявлено, что средняя оценка удобства ног выше в самолетах с двумя проходами -- 3, по сравнению с оценкой в 2.8 у самолетов с одним проходом.

**Вывод:** 
На основе полученных данных можно сделать вывод: если клиенту критически важно достаточное пространство для ног при перелете и у него нет финансовой возможности приобрести билеты в класс выше, то стоит в первую очередь рассматривать самолеты с двумя проходами.

Также следует отметить, что скорее всего не стоит уменьшать пространство для ног в самолетах с одним проходом еще больше. Хоть и решения о расширении и уменьшении пространства для ног в самолетах принимаются на основе коммерческих предпосылок, компаниям, которые получают низкие оценки удобства пространства для ног чаще всего следует принять соответствующие меры по разрешению данной проблемы во избежание оттока клиентов.

#### Вопрос 3

**Вопрос:** Какие лаунж-зоны оценены по чистоте (cleanliness) выше, чем аэропорты в которых они расположены?

**Данные:** для ответа на вопрос нужны таблицы: lounge, airport. 

```{r}
cleanlou = lounge %>%
  filter(!is.na(cleanliness_rating)) %>%
  filter(!is.na(airport)) %>%
  mutate(airport = tolower(airport)) %>%
  group_by(airport) %>%
  summarise(cleanliness_rating = round(mean(cleanliness_rating), 2))


cleanair = airport %>%
  filter(!is.na(terminal_cleanliness_rating)) %>%
  filter(!is.na(airport_name)) %>%
  mutate(airport_name = str_replace_all(airport_name, "-", " ")) %>%
  rename(airport = airport_name) %>%
  group_by(airport) %>%
  summarise(terminal_cleanliness_rating = round(mean(terminal_cleanliness_rating), 2))

clean = inner_join(cleanair, cleanlou, by = "airport") %>%
  filter(cleanliness_rating > terminal_cleanliness_rating) %>%
  mutate(difference = cleanliness_rating - terminal_cleanliness_rating) %>%
  arrange(desc(difference)) %>%
  filter(difference >= 2)

ggplot(clean, aes(x = airport)) +
  geom_bar(aes(y = cleanliness_rating, fill = "Рейтинг чистоты лаунж зон"), stat = "identity",position = position_dodge()) +
  geom_bar(aes(y = terminal_cleanliness_rating, fill = "Рейтинг чистоты аэропортов"), stat = "identity", position = position_dodge()) +
  labs(x = "Название аэропортов с самой большой разницей", y = "Рейтинг", fill = "") +
  ggtitle("Разница между рейтингами чистоты лаунж зон\n и аэропортов, в которых они находятся") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) 

```

**Ответ:** Всего лаунж зон, которые оценивают выше, чем аэропорты, в которых они находятся -- 38. Разница между средними оценками чистоты варьируется от незначительных 0.09 до внушительных 4.00, из-за чего было решено выделить случаи с наибольшей существующей разницей -- от 2 и более. После фильтрации, аэропортов с такой разницей осталось 6, а именно: Berlin Tegel Airport, Geneva Airport, Muscat Seeb Airport, Darwin Airport, Newcastle Airport and Rio De Janeiro Airport. Опять же, стоит учитывать процент погрешности из-за разного количества оценок определенных аэропортов, что влияет на подсчет среднего значения рейтинга.

**Вывод:** Из полученных данных можно сделать вывод, что  аэропортам с слишком большой разницей в оценке чистоты их самих и в оценке чистоты лаунж зон стоит обратить внимание на общую чистоту аэропорта, чтобы не способствовать складыванию негативного впечатления у посетителей, уже оценивших чистоту лаунж зон. Анологично, аэропортам, где лаунж зоны отстают по частоте, (а таких случаев в полученных данных даже больше -- 39, что является проблемой) также следует повысить качество их уборки, так как лаунж зоны, в большинстве своем, создают впечатления об аэропорте. Таким образом, для того чтобы избежать негативных отзывов и оттока клиентов следует в равной мере фокусироваться на поддержании чистоты как и лаунж зон, так и аэропортов в которых они находятся.



### Дэшборд

Полученные выводы обобщены в виде дэшборда со следующими элементами 

**Элемент 1:** 
 - вид: график
 - ответ на вопрос: 2
 - обоснование: ключевым в данной работе был выделен вопрос об удобстве пространства для ног, так как по нему было возможно сделать самые существенные и обоснованные выводы. С помощью столбчатого графика лучше всего иллюстрируется разница между средней оценкой удобства пространства для ног у самолетов с одним проходом и двумя, где видно, что самолеты с двумя проходами уступают по данному критерию самолетам с одним. 
 
**Элемент 2:** 
 - вид: число
 - ответ на вопрос: 3
 - обоснование: с помощью числа 38 наглядно показано количество аэропортов, где лаунж зоны по чистоте  были оценены выше, чем аэропорты, в которых они находятся, на что также интуитивно указывает зеленый цвет. 
 
**Элемент 3:** 
 - вид: число
 - ответ на вопрос: 3
 - обоснование:  с помощью числа 38 наглядно показано количество аэропортов, где лаунж зоны по частоте  были оценены оценены ниже, чем аэропорты, в которых они находятся, что также выделяется красным цветом, чтобы показать негативный подтекст и выделить, что количество аэропортов с грязными лаунж зонами превышает таковые с чистыми.
 
**Элемент 4:** 
 - вид: график
 - ответ на вопрос: 3
 - обоснование: с помощью сгруппированного столбчатого графика проиллюстрированы конкретные аэропорты, в которых разрыв между чистотой лаунж зоной и их самых представляется наиболее значительным.
 
### Общие выводы
Данная работа, в большинстве своем, фокусируется на анализе клиентского опыта посетителей аэропортов и клиентов авиакомпаний. Хоть и ответов на заданные вопросы, не достаточно для того, чтобы дать объективно полезные советы, их хватает для того, чтобы указать на потребность провести более глубокие исследования, ориентированные на узкие вопросы типа оценки wi-fi подключения и т.д., что, в свою очередь, зависит от заинтересованности владельцев авиакомпаний и самих аэропортов. С другой стороны, данная работа с большой вероятностью выявила проблемы с чистотой, как в лаунж зонах, так и в аэропортах в целом, что требует внимания, а также глобальное недовольство пространством для ног в самолетах с любым количеством проходов, так как, независимо оттого, что средняя оценка за удобство у самолетов с одним проходом выше, она все еще (3) слишком низка для того, чтобы самолеты с одним проходом можно было назвать действительно комфортными. Единственное, что можно сказать -- опыт перелета на самолете с двумя проходами у пассажира, имеющего критическую потребность в комфортном пространстве для ног, будет хуже, чем на самолете с одним, что также является сигналом к действию для авиакомпаний.